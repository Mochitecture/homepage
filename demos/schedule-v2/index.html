<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mochitecture – Schedule (Week View v2)</title>
  <link rel="stylesheet" href="./styles.css">
  <!-- スナップショット用（CDN） -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
  <header class="appbar">
    <div class="left">
      <h1>Schedule – Week View</h1>
      <div class="legend" id="legend"></div>
    </div>
    <div class="toolbar">
      <button id="prevBtn" title="前の週">←</button>
      <button id="todayBtn">今日</button>
      <button id="nextBtn" title="次の週">→</button>
      <button id="snapBtn" title="PNGで保存">📸 Snapshot</button>
      <button id="clearBtn" title="このデモの予定を全削除">Clear</button>
      <button id="finderBtn" title="空き時間検索">🕒 Availability</button>
    </div>
  </header>

  <div class="wrap">
    <div class="weekbar" id="weekbar" aria-label="week header"></div>

    <div class="calendar-wrap" id="calendarWrap">
      <div class="calendar" id="calendar" aria-label="week grid"></div>
    </div>
  </div>

  <!-- 予定ダイアログ（datetime-localは不使用） -->
  <dialog id="eventDialog">
    <form method="dialog" id="eventForm">
      <h3>予定</h3>
      <input type="hidden" name="id" />

      <label>タイトル
        <input name="title" placeholder="タイトル" required />
      </label>

      <div class="row">
        <label>開始 日付
          <input name="startDate" type="date" required />
        </label>
        <label>開始 時刻
          <select name="startTime" required></select>
        </label>
      </div>

      <div class="row">
        <label>終了 日付
          <input name="endDate" type="date" required />
        </label>
        <label>終了 時刻
          <select name="endTime" required></select>
        </label>
      </div>

      <label>カレンダー（用途）
        <select name="calendar">
          <option value="Work">Work</option>
          <option value="Personal">Personal</option>
          <option value="Mochitecture" selected>Mochitecture</option>
          <option value="Research">Research</option>
        </select>
      </label>

      <div class="actions">
        <button value="cancel">キャンセル</button>
        <button id="deleteBtn" type="button" class="danger">削除</button>
        <button id="saveBtn" value="default" class="primary">保存</button>
      </div>
    </form>
  </dialog>

  <!-- 空き時間ファインダ -->
  <dialog id="finderDialog">
    <form method="dialog" id="finderForm">
      <h3>空き時間検索（選択カレンダーの重なりなし）</h3>
      <fieldset class="calpick" id="calPick"></fieldset>

      <div class="row">
        <label>必要時間
          <select name="needMin" id="needMin">
            <option value="30">30分</option>
            <option value="45">45分</option>
            <option value="60" selected>60分</option>
            <option value="90">90分</option>
            <option value="120">120分</option>
          </select>
        </label>
        <label>候補時間帯
          <select name="window" id="window">
            <option value="0-24">終日</option>
            <option value="8-20" selected>08:00–20:00</option>
            <option value="9-19">09:00–19:00</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button value="cancel">閉じる</button>
        <button id="runFinder" class="primary">検索</button>
      </div>

      <div id="finderResults" class="results"></div>
    </form>
  </dialog>

  <script src="./app.js"></script>
</body>
</html>
